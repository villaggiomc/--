<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Private Dash - Game Edition</title>
    <style>
        :root { --primary: #8e2de2; --secondary: #4a00e0; }
        body { 
            margin: 0; background: #050510; color: white; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; 
        }
        #ui-layer { text-align: center; z-index: 10; }
        .menu-box { background: rgba(20, 20, 40, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.8); border: 1px solid var(--primary); }
        .level-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
        button { 
            background: linear-gradient(45deg, var(--primary), var(--secondary)); border: none; color: white; 
            padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        button:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--primary); }
        input[type="password"], input[type="color"], select { 
            padding: 10px; border-radius: 5px; border: 1px solid #444; background: #111; color: white; margin: 10px;
        }
        canvas { 
            display: none; background: #0a0a1a; border-bottom: 4px solid #fff; 
            box-shadow: 0 0 50px rgba(0,0,0,0.5); 
        }
        .stats { position: absolute; top: 20px; left: 20px; font-size: 18px; display: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="pass-screen" class="menu-box">
            <h1>ACCESSO RISERVATO</h1>
            <p>Inserisci la chiave per giocare</p>
            <input type="password" id="password" placeholder="Password...">
            <button onclick="checkPass()">ENTRA</button>
        </div>

        <div id="menu-screen" class="menu-box" style="display:none;">
            <h1>MY DASH</h1>
            <div style="background: #1a1a3a; padding: 15px; border-radius: 10px;">
                <label>Colore:</label> <input type="color" id="pColor" value="#00ffff">
                <label>Icona:</label> 
                <select id="pShape">
                    <option value="square">Cubo Classico</option>
                    <option value="circle">Palla Rotante</option>
                </select>
            </div>
            <h3>SELEZIONA DIFFICOLTÀ</h3>
            <div class="level-grid" id="levels"></div>
        </div>
    </div>

    <div id="game-info" class="stats">LIVELLO: <span id="lvl-num">1</span></div>
    <canvas id="gameCanvas" width="900" height="400"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    // --- CONFIGURAZIONE ---
    const PASS_SEGRETA = "game"; // Cambiala pure qui
    let gameActive = false;
    let score = 0;
    
    const player = {
        x: 100, y: 340, w: 40, h: 40,
        dy: 0, gravity: 0.9, jump: -15,
        ground: 340, rot: 0, isJumping: false,
        color: "#00ffff", shape: "square"
    };

    // Generazione 10 Livelli: velocità crescente e ostacoli più densi
    const levels = Array.from({length: 10}, (_, i) => ({
        speed: 7 + (i * 1.5),
        gap: 400 - (i * 20),
        count: 10 + (i * 5)
    }));

    let obstacles = [];

    function checkPass() {
        if(document.getElementById("password").value === PASS_SEGRETA) {
            document.getElementById("pass-screen").style.display = "none";
            document.getElementById("menu-screen").style.display = "block";
            buildLevelMenu();
        } else { alert("Accesso Negato"); }
    }

    function buildLevelMenu() {
        const container = document.getElementById("levels");
        levels.forEach((l, i) => {
            const btn = document.createElement("button");
            btn.innerText = i + 1;
            btn.onclick = () => start(i);
            container.appendChild(btn);
        });
    }

    function start(idx) {
        player.color = document.getElementById("pColor").value;
        player.shape = document.getElementById("pShape").value;
        player.y = player.ground;
        player.dy = 0;
        player.rot = 0;
        
        document.getElementById("ui-layer").style.display = "none";
        document.getElementById("game-info").style.display = "block";
        document.getElementById("lvl-num").innerText = idx + 1;
        canvas.style.display = "block";
        
        // Genera Mappa
        const config = levels[idx];
        obstacles = [];
        for(let j = 0; j < config.count; j++) {
            obstacles.push({
                x: 1000 + (j * config.gap) + (Math.random() * 100),
                w: 35, h: 45
            });
        }
        
        gameActive = true;
        speed = config.speed;
        update();
    }

    function drawPlayer() {
        ctx.save();
        // Centro della rotazione sul personaggio
        ctx.translate(player.x + player.w/2, player.y + player.h/2);
        ctx.rotate(player.rot * Math.PI / 180);
        
        ctx.fillStyle = player.color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = player.color;

        if(player.shape === "square") {
            ctx.fillRect(-player.w/2, -player.h/2, player.w, player.h);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            ctx.strokeRect(-player.w/2, -player.h/2, player.w, player.h);
        } else {
            ctx.beginPath();
            ctx.arc(0, 0, player.w/2, 0, Math.PI*2);
            ctx.fill();
            ctx.stroke();
        }
        ctx.restore();
    }

    function update() {
        if(!gameActive) return;

        // Pulizia e Sfondo
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Effetto scorrimento pavimento
        ctx.strokeStyle = "#333";
        for(let i=0; i<20; i++) {
            ctx.beginPath();
            ctx.moveTo((i*50 - (Date.now()/10 % 50)), 385);
            ctx.lineTo((i*50 - (Date.now()/10 % 50)) + 20, 385);
            ctx.stroke();
        }

        // Fisica
        player.dy += player.gravity;
        player.y += player.dy;

        if(player.y >= player.ground) {
            player.y = player.ground;
            player.dy = 0;
            player.isJumping = false;
            // Snapping rotazione al multiplo di 90 più vicino (effetto atterraggio perfetto)
            player.rot = Math.round(player.rot / 90) * 90;
        } else {
            // Rotazione continua durante il salto
            player.rot += 6; 
        }

        drawPlayer();

        // Gestione Ostacoli
        for(let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.x -= speed;

            // Disegna Spina (Spike)
            ctx.fillStyle = "#ff2255";
            ctx.shadowColor = "#ff2255";
            ctx.beginPath();
            ctx.moveTo(o.x, 380);
            ctx.lineTo(o.x + o.w/2, 380 - o.h);
            ctx.lineTo(o.x + o.w, 380);
            ctx.fill();

            // Collisione (Hitbox leggermente più piccola per essere più permissivi)
            if(player.x + 30 > o.x && player.x < o.x + o.w - 5 && player.y + 35 > 380 - o.h) {
                gameOver();
            }
        }

        // Vittoria
        if(obstacles.length > 0 && obstacles[obstacles.length-1].x < -100) {
            alert("LIVELLO COMPLETATO!");
            resetUI();
        }

        requestAnimationFrame(update);
    }

    function jump() {
        if(!player.isJumping && gameActive) {
            player.dy = player.jump;
            player.isJumping = true;
        }
    }

    function gameOver() {
        gameActive = false;
        alert("Ops! Ritenta.");
        resetUI();
    }

    function resetUI() {
        gameActive = false;
        canvas.style.display = "none";
        document.getElementById("game-info").style.display = "none";
        document.getElementById("ui-layer").style.display = "block";
        document.getElementById("menu-screen").style.display = "block";
    }

    // Input
    window.addEventListener("keydown", (e) => { if(e.code === "Space" || e.code === "ArrowUp") jump(); });
    canvas.addEventListener("mousedown", jump);

</script>
</body>
</html>
